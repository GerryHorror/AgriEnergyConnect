@model AgriEnergyConnect.Models.ViewModels.FarmerViewModel

@{
    ViewData["Title"] = "Add Farmer";
    Layout = "_EmployeeLayout";
}


@section Styles {
    <link rel="stylesheet" href="~/css/employee-addfarmer.css" />
}

<div class="dashboard-content">
    <div class="employee-addfarmer-card card shadow-sm">
        <div class="card-body">
            <h2 class="mb-1 employee-title">Add New Farmer</h2>
            <p class="subtitle mb-4">Create a new farmer account with access to the platform</p>

            @if (TempData["SuccessMessage"] != null)
            {
                <div class="alert alert-success employee-addfarmer-alert">@TempData["SuccessMessage"]</div>
            }
            @if (TempData["ErrorMessage"] != null)
            {
                <div class="alert alert-danger employee-addfarmer-alert">@TempData["ErrorMessage"]</div>
            }

            <form asp-action="AddFarmer" method="post" novalidate id="addFarmerForm">
                <div asp-validation-summary="ModelOnly" class="alert alert-danger mb-3" style="display:none"></div>

                <!-- Personal Information -->
                <h5 class="employee-addfarmer-section-title mt-3">Personal Information</h5>
                <hr class="employee-addfarmer-divider" />
                <div class="row">
                    <!-- First Name -->
                    <div class="col-md-6 mb-3">
                        <label asp-for="FirstName" class="form-label employee-addfarmer-form-label"></label>
                        <div class="input-group has-validation">
                            <span class="input-group-text bg-light">
                                <i class="fa-solid fa-user icon-muted icon-md"></i>
                            </span>
                            <input asp-for="FirstName" class="form-control employee-addfarmer-input" placeholder="e.g. John" />
                        </div>
                        <span asp-validation-for="FirstName" class="employee-addfarmer-validation text-danger small"></span>
                    </div>

                    <!-- Last Name -->
                    <div class="col-md-6 mb-3">
                        <label asp-for="LastName" class="form-label employee-addfarmer-form-label"></label>
                        <div class="input-group has-validation">
                            <span class="input-group-text bg-light">
                                <i class="fa-solid fa-user icon-muted icon-md"></i>
                            </span>
                            <input asp-for="LastName" class="form-control employee-addfarmer-input" placeholder="e.g. Doe" />
                        </div>
                        <span asp-validation-for="LastName" class="employee-addfarmer-validation text-danger small"></span>
                    </div>

                    <!-- Email -->
                    <div class="col-md-6 mb-3">
                        <label asp-for="Email" class="form-label employee-addfarmer-form-label"></label>
                        <div class="input-group has-validation">
                            <span class="input-group-text bg-light">
                                <i class="fa-solid fa-envelope icon-blue icon-md"></i>
                            </span>
                            <input asp-for="Email" class="form-control employee-addfarmer-input" placeholder="e.g. john.doe@email.com" />
                        </div>
                        <span asp-validation-for="Email" class="employee-addfarmer-validation text-danger small"></span>
                    </div>

                    <!-- Phone Number -->
                    <div class="col-md-6 mb-3">
                        <label asp-for="PhoneNumber" class="form-label employee-addfarmer-form-label"></label>
                        <div class="input-group has-validation">
                            <span class="input-group-text bg-light">
                                <i class="fa-solid fa-phone-alt icon-green icon-md"></i>
                            </span>
                            <input asp-for="PhoneNumber" class="form-control employee-addfarmer-input" placeholder="e.g. 0123456789" />
                        </div>
                        <span asp-validation-for="PhoneNumber" class="employee-addfarmer-validation text-danger small"></span>
                    </div>

                    <!-- Farm Name -->
                    <div class="col-md-6 mb-3">
                        <label asp-for="FarmName" class="form-label employee-addfarmer-form-label"></label>
                        <div class="input-group has-validation">
                            <span class="input-group-text bg-light">
                                <i class="fa-solid fa-tractor icon-orange icon-md"></i>
                            </span>
                            <input asp-for="FarmName" class="form-control employee-addfarmer-input" placeholder="e.g. Green Valley Farm" />
                        </div>
                        <span asp-validation-for="FarmName" class="employee-addfarmer-validation text-danger small"></span>
                    </div>

                    <!-- Location -->
                    <div class="col-md-6 mb-3">
                        <label asp-for="Location" class="form-label employee-addfarmer-form-label"></label>
                        <div class="input-group has-validation">
                            <span class="input-group-text bg-light">
                                <i class="fa-solid fa-map-marker-alt icon-green icon-md"></i>
                            </span>
                            <input asp-for="Location" class="form-control employee-addfarmer-input" placeholder="e.g. Western Cape" />
                        </div>
                        <span asp-validation-for="Location" class="employee-addfarmer-validation text-danger small"></span>
                    </div>

                    <!-- Username -->
                    <div class="col-md-6 mb-3">
                        <label asp-for="Username" class="form-label employee-addfarmer-form-label"></label>
                        <div class="input-group has-validation">
                            <span class="input-group-text bg-light" data-bs-toggle="tooltip" title="Username must be unique.">
                                <i class="fa-solid fa-user-circle icon-muted icon-md"></i>
                            </span>
                            <input asp-for="Username" class="form-control employee-addfarmer-input" placeholder="Choose a username" />
                        </div>
                        <span asp-validation-for="Username" class="employee-addfarmer-validation text-danger small"></span>
                    </div>

                    <!-- Password -->
                    <div class="col-md-6 mb-3">
                        <label asp-for="Password" class="form-label employee-addfarmer-form-label"></label>
                        <div class="input-group has-validation">
                            <span class="input-group-text bg-light" data-bs-toggle="tooltip" title="Password must be at least 6 characters.">
                                <i class="fa-solid fa-lock icon-muted icon-md"></i>
                            </span>
                            <input asp-for="Password" class="form-control employee-addfarmer-input" placeholder="Set a password" />
                        </div>
                        <span asp-validation-for="Password" class="employee-addfarmer-validation text-danger small"></span>
                    </div>
                </div>

                <p class="employee-addfarmer-note mt-3">* Required fields</p>

                <div class="employee-addfarmer-btn-group d-flex justify-content-end gap-2 mt-4">
                    <a href="@Url.Action("Dashboard", "Employee")" class="btn employee-addfarmer-btn-cancel btn-outline-secondary">Cancel</a>
                    <button type="submit" class="btn employee-addfarmer-btn-submit btn-primary" id="addFarmerSubmitBtn">
                        <span id="addFarmerSubmitSpinner" class="spinner-border spinner-border-sm me-2" style="display:none" role="status" aria-hidden="true"></span>
                        Add Farmer
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        // Enable tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // Show loading spinner on submit
        document.getElementById('addFarmerForm').addEventListener('submit', function() {
            var submitBtn = document.getElementById('addFarmerSubmitBtn');
            var spinner = document.getElementById('addFarmerSubmitSpinner');
            if (submitBtn && spinner) {
                submitBtn.disabled = true;
                spinner.style.display = 'inline-block';
            }
        });

        // Show validation summary if errors exist
        const validationSummary = document.querySelector('[asp-validation-summary="ModelOnly"]');
        if (validationSummary && validationSummary.innerText.trim() !== "") {
            validationSummary.style.display = '';
        }
    </script>
}
